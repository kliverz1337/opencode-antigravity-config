const translations = {
    // Top Bar & Steps
    'Welcome': { EN: 'Welcome', ID: 'Menu Utama' },
    'oMo Model': { EN: 'oMo Model', ID: 'oMo Model' },
    'System': { EN: 'System', ID: 'Sistem' },
    'Config': { EN: 'Config', ID: 'Konfigurasi' },
    'Install': { EN: 'Install', ID: 'Instal' },
    'Done': { EN: 'Done', ID: 'Selesai' },

    // Page 0: Welcome
    'Install konfigurasi lengkap Opencode Antigravity stack:': { EN: 'Install full Opencode Antigravity stack config:', ID: 'Install konfigurasi lengkap Opencode Antigravity stack:' },
    'Get Started â†’': { EN: 'Get Started â†’', ID: 'Mulai â†’' },
    'ðŸ”„ Updates': { EN: 'ðŸ”„ Updates', ID: 'ðŸ”„ Cek Update' },
    'ðŸ—‘ Uninstall': { EN: 'ðŸ—‘ Uninstall', ID: 'ðŸ—‘ Copot' },

    // Page 1: oMo Agent Model
    'oMo Agent Model': { EN: 'oMo Agent Model', ID: 'Model AI oMo Agent' },
    'Konfigurasi model AI untuk setiap agent': { EN: 'Configure AI model for each agent', ID: 'Konfigurasi model AI untuk setiap agent' },

    // Page 2: System Check
    'System Check': { EN: 'System Check', ID: 'Cek Sistem' },
    'Checking environment...': { EN: 'Checking environment...', ID: 'Memeriksa system...' },
    'ðŸ”„ Re-check': { EN: 'ðŸ”„ Re-check', ID: 'ðŸ”„ Cek Ulang' },
    'â† Back': { EN: 'â† Back', ID: 'â† Kembali' },
    'Continue â†’': { EN: 'Continue â†’', ID: 'Lanjutkan â†’' },

    // Page 3: Config
    'Configuration': { EN: 'Configuration', ID: 'Konfigurasi' },
    'API Keys & file selection': { EN: 'API Keys & file selection', ID: 'API Key & pemilihan file' },
    'ðŸ“¥ Import': { EN: 'ðŸ“¥ Import', ID: 'ðŸ“¥ Ambil' },
    'ðŸ“¤ Export': { EN: 'ðŸ“¤ Export', ID: 'ðŸ“¤ Simpan' },
    '(Optional)': { EN: '(Optional)', ID: '(Opsional)' },
    'API Key (console.supermemory.ai/keys)': { EN: 'API Key (console.supermemory.ai/keys)', ID: 'API Key (console.supermemory.ai/keys)' },
    'API Key (opensync.dev â†’ Settings)': { EN: 'API Key (opensync.dev â†’ Settings)', ID: 'API Key (opensync.dev â†’ Pengaturan)' },
    'Convex URL': { EN: 'Convex URL', ID: 'URL Convex' },
    'FILES TO INSTALL': { EN: 'FILES TO INSTALL', ID: 'FILE UNTUK DIINSTAL' },
    'All': { EN: 'All', ID: 'Semua' },
    'None': { EN: 'None', ID: 'Kosong' },
    'OPTIONS': { EN: 'OPTIONS', ID: 'PILIHAN' },
    'PLUGINS': { EN: 'PLUGINS', ID: 'PLUGIN' },
    'Backup konfigurasi lama': { EN: 'Backup old configuration', ID: 'Backup konfigurasi lama' },
    'Jalankan npm install': { EN: 'Run npm install', ID: 'Jalankan npm install' },
    'Install Now â†’': { EN: 'Install Now â†’', ID: 'Mulai Instal â†’' },

    // Page 4: Installing
    'Installing...': { EN: 'Installing...', ID: 'Menginstal...' },
    'Menyalin konfigurasi...': { EN: 'Copying configurations...', ID: 'Menyalin konfigurasi...' },
    'Log': { EN: 'Log', ID: 'Log' },
    'Finish âœ“': { EN: 'Finish âœ“', ID: 'Selesai âœ“' },

    // Page 5: Done
    'Installation Complete!': { EN: 'Installation Complete!', ID: 'Instalasi Selesai!' },
    'Antigravity OpenCode siap digunakan': { EN: 'Antigravity OpenCode is ready to use', ID: 'Antigravity OpenCode siap digunakan' },
    'ðŸ“ Config Location': { EN: 'ðŸ“ Config Location', ID: 'ðŸ“ Lokasi Config' },
    'ðŸš€ Next Steps': { EN: 'ðŸš€ Next Steps', ID: 'ðŸš€ Langkah Berikut' },
    'ðŸ“‚ Config': { EN: 'ðŸ“‚ Config', ID: 'ðŸ“‚ Buka Config' },
    'ðŸ”‘ Auth': { EN: 'ðŸ”‘ Auth', ID: 'ðŸ”‘ Login' },
    'ðŸ’» CLI': { EN: 'ðŸ’» CLI', ID: 'ðŸ’» CLI' },
    'ðŸŒ Web': { EN: 'ðŸŒ Web', ID: 'ðŸŒ Web 8080' },
    'Close': { EN: 'Close', ID: 'Tutup' },

    // Modals & Dynamic
    'âœ“ Set': { EN: 'âœ“ Set', ID: 'âœ“ Diisi' },
    'âœ— Invalid': { EN: 'âœ— Invalid', ID: 'âœ— Tidak Valid' },
    'Checking...': { EN: 'Checking...', ID: 'Memeriksa...' },
    'Not found â€” npm i -g opencode@latest': { EN: 'Not found â€” run npm i -g opencode@latest', ID: 'Tidak ada â€” jalankan npm i -g opencode@latest' },
    'ðŸ”’ Core (Required)': { EN: 'ðŸ”’ Core (Required)', ID: 'ðŸ”’ Wajib (Core)' },
    'âš™ï¸ Optional': { EN: 'âš™ï¸ Optional', ID: 'âš™ï¸ Opsional' },
    'âš  No key': { EN: 'âš  No key', ID: 'âš  Tanpa key' },
    'ðŸ‘ Preview opencode.json': { EN: 'ðŸ‘ Preview opencode.json', ID: 'ðŸ‘ Pratinjau opencode.json' },

    // Close Modal
    'Close confirm title': { EN: 'Close Application', ID: 'Tutup Aplikasi' },
    'Close confirm text': { EN: 'Are you sure you want to exit the setup?', ID: 'Apakah Anda yakin ingin keluar dari program?' },
    'Close cancel': { EN: 'No', ID: 'Tidak' },
    'Close exit': { EN: 'Yes, Exit', ID: 'Ya, Keluar' }
};

let currentLang = 'ID'; // Default

function t(key) {
    if (!translations[key]) return key;
    return translations[key][currentLang] || key;
}

// Elements mapping explicitly for DOM nodes
// Page layout: 0=Welcome, 1=oMo Model, 2=System, 3=Config, 4=Install, 5=Done
const tMap = [
    // Step indicators (6 steps)
    { selector: '#step0 span', key: 'Welcome' },
    { selector: '#step1 span', key: 'oMo Model' },
    { selector: '#step2 span', key: 'System' },
    { selector: '#step3 span', key: 'Config' },
    { selector: '#step4 span', key: 'Install' },
    { selector: '#step5 span', key: 'Done' },

    // Page 0: Welcome
    { selector: '#page0 .subtitle', key: 'Install konfigurasi lengkap Opencode Antigravity stack:' },
    { selector: '#btnStart', key: 'Get Started â†’', isNode: true },
    { selector: '#btnVersionCheck', key: 'ðŸ”„ Updates' },
    { selector: '#btnUninstall', key: 'ðŸ—‘ Uninstall' },

    // Page 1: oMo Agent Model
    { selector: '#page1 .page-header h2', key: 'oMo Agent Model' },
    { selector: '#page1 .page-header p', key: 'Konfigurasi model AI untuk setiap agent' },
    { selector: '#btnPrev1', key: 'â† Back' },
    { selector: '#btnNext1', key: 'Continue â†’' },

    // Page 2: System Check
    { selector: '#page2 .page-header h2', key: 'System Check' },
    { selector: '#page2 .page-header p', key: 'Checking environment...' },
    { selector: '#btnRecheck', key: 'ðŸ”„ Re-check' },
    { selector: '#btnPrev2', key: 'â† Back' },
    { selector: '#btnNext2', key: 'Continue â†’' },

    // Page 3: Config
    { selector: '#page3 .page-header h2', key: 'Configuration' },
    { selector: '#page3 .page-header p', key: 'API Keys & file selection' },
    { selector: '#btnImport', key: 'ðŸ“¥ Import' },
    { selector: '#btnExport', key: 'ðŸ“¤ Export' },
    { selector: '#page3 .form-group:nth-of-type(2) .help-text', key: 'API Key (console.supermemory.ai/keys)' },
    { selector: '#page3 .form-group:nth-of-type(3) .help-text:nth-of-type(1)', key: 'API Key (opensync.dev â†’ Settings)' },
    { selector: '#page3 .form-group:nth-of-type(3) .label-row:nth-of-type(2) .help-text', key: 'Convex URL' },
    { selector: '#page3 .grey-label:nth-of-type(1)', key: 'FILES TO INSTALL' },
    { selector: '#btnSelectAll', key: 'All' },
    { selector: '#btnDeselectAll', key: 'None' },

    { selector: '#page3 .grey-label:nth-of-type(2)', key: 'OPTIONS' },
    { selector: '#chkBackup + .checkmark', nextSibText: 'Backup konfigurasi lama' },
    { selector: '#chkNpmInstall + .checkmark', nextSibText: 'Jalankan npm install' },

    { selector: '#lblCorePlugins', key: 'ðŸ”’ Core (Required)' },
    { selector: '#lblOptionalPlugins', key: 'âš™ï¸ Optional' },
    { selector: '#warnSupermemory', key: 'âš  No key' },
    { selector: '#warnOpenSync', key: 'âš  No key' },
    { selector: '#btnPreviewConfig', key: 'ðŸ‘ Preview opencode.json' },

    { selector: '#btnPrev3', key: 'â† Back' },
    { selector: '#btnNext3', key: 'Install Now â†’' },

    // Page 4: Installing
    { selector: '#installTitle', key: 'Installing...' },
    { selector: '#installSubtitle', key: 'Menyalin konfigurasi...' },
    { selector: '.log-title', key: 'Log' },
    { selector: '#btnNext4', key: 'Finish âœ“' },

    // Page 5: Done
    { selector: '#page5 h2', key: 'Installation Complete!' },
    { selector: '#page5 .success-text', key: 'Antigravity OpenCode siap digunakan' },
    { selector: '#page5 .cyan-label', key: 'ðŸ“ Config Location' },
    { selector: '#page5 .purple-label', key: 'ðŸš€ Next Steps' },
    { selector: '#btnOpenFolder', key: 'ðŸ“‚ Config' },
    { selector: '#btnAuthLogin', key: 'ðŸ”‘ Auth' },
    { selector: '#btnRunCLI', key: 'ðŸ’» CLI' },
    { selector: '#btnRunWeb', key: 'ðŸŒ Web' },
    { selector: '#btnFinish', key: 'Close' }
];

function updateLanguage(lang) {
    currentLang = lang;
    window.currentLang = lang;
    document.getElementById('btnLang').textContent = lang === 'EN' ? 'EN / id' : 'ID / en';

    tMap.forEach(item => {
        const el = document.querySelector(item.selector);
        if (el) {
            if (item.nextSibText) {
                // For label checkboxes, the text is the next sibling after checkmark
                const textNode = Array.from(el.parentNode.childNodes).find(n => n.nodeType === 3 && n.textContent.trim().length > 0);
                if (textNode) textNode.textContent = t(item.nextSibText);
            } else {
                el.innerText = t(item.key);
            }
        }
    });

    // Update dynamic placeholders/indicators
    const vsm = document.getElementById('valSupermemory');
    if (vsm && vsm.classList.contains('val-empty')) vsm.textContent = t('(Optional)');
    if (vsm && vsm.classList.contains('val-ok')) vsm.textContent = t('âœ“ Set');
    if (vsm && vsm.classList.contains('val-bad')) vsm.textContent = t('âœ— Invalid');

    const vos = document.getElementById('valOpenSyncKey');
    if (vos && vos.classList.contains('val-empty')) vos.textContent = t('(Optional)');
    if (vos && vos.classList.contains('val-ok')) vos.textContent = t('âœ“ Set');
    if (vos && vos.classList.contains('val-bad')) vos.textContent = t('âœ— Invalid');

    const vou = document.getElementById('valOpenSyncUrl');
    if (vou && vou.classList.contains('val-empty')) vou.textContent = t('(Optional)');
    if (vou && vou.classList.contains('val-ok')) vou.textContent = t('âœ“ Set');
    if (vou && vou.classList.contains('val-bad')) vou.textContent = t('âœ— Invalid');

    // Trigger re-render of currently visible modal if needed
    window._lastLangUpdate = Date.now();

    // Also re-run validation logic text updates
    if (typeof window.reValInputs === 'function') window.reValInputs();
}

window.t = t;
window.updateLanguage = updateLanguage;
window.currentLang = currentLang;
